---
title: "project_Hyperboria"
author: "Rémy CERDA and Valentin Lorentz"
date: "29 novembre 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("ggplot2")
```

# Produce data

On a computer connected to Hyperboria, create the file “scan_data.csv” with this content:

```
timestamp,round_start_timestamp,node,seq,nb_bytes,ttl,latency
```

Then, run:

* `python3 ping_scan.py` wait for the results, press Ctrl-C. This will produce `scan_data.csv`.
* `gzip scan_data.csv` (the result is in this git repo)
* `cat scan_data.csv.gz | gunzip | sed "s/ ms//" | gzip > scan_data_fixed.csv.gz`

And:

* `wget https://www.fc00.org/static/graph.json` (the result is in this git repo)
* `python3 compute_distances.py`. This will produce `node_distances.csv`.



# Load data

```{r, include=FALSE}
library(ggplot2)
```

## Data structure

Each line is a ping sent to an Hyperboria node, using Debian's `ping`.

Columns are:

* timestamp: timestamp the ping was sent, as reported by ping.
* round_start_timestamp: timestamp the `ping` tool was invoked at.
* node: IPv6 address of the pinged node.
* seq: sequence number, as reported by ping. There is a bug with my script: for nodes that can be pinged, the seq is from 2 to 4, and for nodes which could not be reach it is from 0 to 2. The former should be fixed before analysing data.
* nb_bytes: number of bytes of the ICMP PING, as reported by ping
* ttl: ICMP TTL, as reported by ping
* latency: latency reported by ping.

```{r}
data = read.csv("scan_data_fixed.csv.gz")
head(data)
summary(data)
```

## Fixes

Compensate offset bug of the ping collection script.

```{r}
lines_with_seq_offset = !is.na(data$latency)
data$seq[lines_with_seq_offset] = data$seq[lines_with_seq_offset]-2
summary(data$seq)
```

## Distances database

```
distances = read.csv("node_distances.csv")
```


# Analysis

First, let us have a look to the repartition of latency:
```{r}
summary(data$latency)
ggplot(data=data, aes(x=latency)) + xlim(0, 2000) + geom_histogram(binwidth=100);
```

## Sample data

Take a sample for faster tests

```{r}
sample_data = data[sample(nrow(data), 1000),]
```
